# âœ… API Completa: ValidaÃ§Ã£o, Testes e Frontend

Este projeto representa o nÃ­vel final da formaÃ§Ã£o bÃ¡sica em Go. Aqui, expandimos uma API REST com Gin para incluir **ValidaÃ§Ã£o de Dados** rigorosa, **Testes Automatizados** (UnitÃ¡rios/IntegraÃ§Ã£o) e integraÃ§Ã£o com **Frontend (HTML/CSS)** renderizado pelo Go.

## ğŸš€ Novas CompetÃªncias Adquiridas

Diferente dos mÃ³dulos anteriores, aqui o foco nÃ£o Ã© apenas "funcionar", mas "funcionar corretamente e com seguranÃ§a".

  * **ValidaÃ§Ã£o de Structs:** Uso de tags para garantir que CPF e RG tenham o tamanho e formato corretos antes de salvar no banco.
  * **Testes Automatizados:** CriaÃ§Ã£o de testes para garantir que as rotas retornem os status codes e dados esperados.
  * **Arquivos EstÃ¡ticos:** ConfiguraÃ§Ã£o do Gin para servir CSS e HTML (Templates).
  * **Mock de Dados:** TÃ©cnicas para testar a API sem depender 100% do banco de dados em todos os cenÃ¡rios.

-----

## ğŸ› ï¸ Tecnologias e Bibliotecas

  * **[Gin Gonic](https://github.com/gin-gonic/gin):** Framework Web.
  * **[GORM](https://gorm.io/):** ORM para PostgreSQL.
  * **[Validator v2](https://gopkg.in/validator.v2):** Biblioteca para validaÃ§Ã£o de dados via tags.
  * **[Testify](https://github.com/stretchr/testify):** (Opcional) Usado para facilitar asserÃ§Ãµes nos testes (`assert.Equal`).

-----

## ğŸ§  Destaques do CÃ³digo

### 1\. ValidaÃ§Ã£o de Dados (`models/aluno.go`)

Em vez de encher o Controller de `if len(cpf) != 11`, usamos tags na Struct. O Gin e o Validator fazem o trabalho pesado.

```go
type Aluno struct {
    gorm.Model
    // Validate: nÃ£o pode ser vazio (nonzero)
    Nome string `json:"nome" validate:"nonzero"`
    // Validate: deve ter tamanho 11 e apenas nÃºmeros regex
    CPF  string `json:"cpf" validate:"len=11, regexp=^[0-9]+$"`
    RG   string `json:"rg" validate:"len=9, regexp=^[0-9]+$"`
}

// FunÃ§Ã£o auxiliar que chama o validador
func ValidateData(aluno *Aluno) error {
    if err := validator.Validate(aluno); err != nil {
        return err
    }
    return nil
}
```

### 2\. Testes Automatizados (`main_test.go`)

O Go possui um pacote nativo robusto para testes (`testing` e `net/http/httptest`).

**Exemplo de teste de rota:**

```go
func TestVerificaStatusCodeSaudacao(t *testing.T) {
    rotas := SetupRotasTeste() // Cria um router isolado
    
    // Simula uma requisiÃ§Ã£o GET
    req, _ := http.NewRequest("GET", "/Guilherme", nil)
    w := httptest.NewRecorder() // Gravador de resposta
    
    rotas.ServeHTTP(w, req) // Executa a rota

    // Verifica se o cÃ³digo HTTP Ã© 200 (OK)
    assert.Equal(t, http.StatusOK, w.Code)
}
```

### 3\. Servindo HTML e CSS (`routes/routes.go`)

O Gin facilita muito a configuraÃ§Ã£o de arquivos estÃ¡ticos comparado ao `net/http` puro.

```go
// Carrega os templates HTML da pasta
r.LoadHTMLGlob("templates/*")

// Define que a rota /assets vai servir arquivos da pasta ./assets
r.Static("/assets", "./assets")

// Rota que renderiza HTML
r.GET("/index", func(c *gin.Context) {
    c.HTML(200, "index.html", gin.H{
        "alunos": listaDeAlunos,
    })
})
```

-----

## âš™ï¸ Como Executar

### 1\. Subindo o Ambiente (Docker)

Este projeto utiliza PostgreSQL 16.

```bash
docker-compose up -d
```

### 2\. Executando a AplicaÃ§Ã£o

```bash
go mod tidy
go run main.go
```

  * **API:** http://localhost:8080/alunos
  * **Frontend:** http://localhost:8080/index (VisualizaÃ§Ã£o HTML)

### 3\. Executando os Testes ğŸ§ª

Para rodar a bateria de testes automatizados e verificar a integridade da API:

```bash
go test -v
```

*(O flag `-v` mostra o log detalhado de cada teste executado)*.

-----

## ğŸ“‚ Estrutura do Projeto

```bash
06-Validacao-Teste-Mais/
â”œâ”€â”€ assets/          # Arquivos CSS (Estilos)
â”œâ”€â”€ controllers/     # LÃ³gica das rotas
â”œâ”€â”€ database/        # ConexÃ£o GORM (com TimeZone configurado)
â”œâ”€â”€ models/          # Structs e ValidaÃ§Ãµes
â”œâ”€â”€ routes/          # ConfiguraÃ§Ã£o de rotas e arquivos estÃ¡ticos
â”œâ”€â”€ templates/       # Arquivos HTML (Index, 404)
â”œâ”€â”€ main.go          # Entry point
â”œâ”€â”€ main_test.go     # ğŸ§ª ARQUIVO DE TESTES
â””â”€â”€ docker-compose.yml
```

-----

Desenvolvido com ğŸ’œ e Go.